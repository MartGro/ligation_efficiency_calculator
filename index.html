<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>4-mer Ligation Efficiency Lookup</title>
    <style>
        .good {
            color: green;
        }
        .average {
            color: goldenrod;
        }
        .poor {
            color: red;
        }
    </style>
    <script>
        const correctEfficiencyThresholds = { low: 1673, high: 3367 };

        async function lookupEfficiency() {
            event.preventDefault();
            const sequence = document.getElementById('sequence-input').value.toUpperCase();
            const response = await fetch('all_ligation_efficiency.csv');
            const csvText = await response.text();
            const rows = csvText.split('\n');
            let correctEfficiency = 'Not found';
            let incorrectEfficiency = 'Not found';

            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].split(',');
                if (cells[0] === sequence) {
                    correctEfficiency = parseFloat(cells[1]);
                    incorrectEfficiency = parseFloat(cells[2]);
                    break;
                }
            }

            document.getElementById('correct-result').textContent = `Correct Ligation Efficiency for ${sequence}: `;
            document.getElementById('correct-result').appendChild(createEfficiencyElement(correctEfficiency, 'correct'));

            // Calculate the relative off-target efficiency
            let relativeIncorrectEfficiency = 'Not found';
            if (correctEfficiency !== 'Not found' && incorrectEfficiency !== 'Not found') {
                relativeIncorrectEfficiency = (incorrectEfficiency / correctEfficiency * 100).toFixed(2);
            }

            document.getElementById('incorrect-result').textContent = `Relative Off-Target Efficiency for ${sequence}: `;
            document.getElementById('incorrect-result').appendChild(createEfficiencyElement(relativeIncorrectEfficiency, 'incorrect'));
        }

        function createEfficiencyElement(efficiency, type) {
            const efficiencyValue = isNaN(efficiency) ? efficiency : parseFloat(efficiency);
            const span = document.createElement('span');
            span.textContent = efficiencyValue;

            if (type === 'correct') {
                if (efficiencyValue === 'Not found') {
                    span.className = 'poor';
                    span.title = 'This sequence does not have an efficiency rating.';
                } else if (efficiencyValue > correctEfficiencyThresholds.high) {
                    span.className = 'good';
                    span.title = 'This is a high correct ligation efficiency.';
                } else if (efficiencyValue > correctEfficiencyThresholds.low) {
                    span.className = 'average';
                    span.title = 'This is an average correct ligation efficiency.';
                } else {
                    span.className = 'poor';
                    span.title = 'This is a low correct ligation efficiency.';
                }
            } else if (type === 'incorrect') {
                if (efficiencyValue === 'Not found') {
                    span.className = '';
                    span.title = 'Off-target efficiency is not applicable.';
                } else if (efficiencyValue > 70) {
                    span.className = 'poor';
                    span.title = 'This is a poor off-target efficiency, indicating a high level of incorrect ligation.';
                } else if (efficiencyValue > 30) {
                    span.className = 'average';
                    span.title = 'This is an average off-target efficiency.';
                } else {
                    span.className = 'good';
                    span.title = 'This is a good off-target efficiency, indicating a low level of incorrect ligation.';
                }
            }

            return span;
        }
    </script>
</head>
<body>
    <h1>4-mer Ligation Efficiency Lookup</h1>
    <form onsubmit="lookupEfficiency()">
        <input type="text" id="sequence-input" maxlength="4" placeholder="Enter 4-mer (e.g., ACCT)" required>
        <input type="submit" value="Lookup">
    </form>
    <p id="correct-result"></p>
    <p id="incorrect-result"></p>
</body>
</html>

