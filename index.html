<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>4-mer Ligation Efficiency Lookup</title>
    <style>
        .good {
            color: green;
        }
        .average {
            color: goldenrod;
        }
        .poor {
            color: red;
        }
    </style>
    <script>
        const correctEfficiencyThresholds = { low: 1673, high: 3367 };

        async function lookupEfficiency() {
            event.preventDefault();
            const sequence = document.getElementById('sequence-input').value.toUpperCase();
            const response = await fetch('ligation_efficiency_T4_37C_1h_correct_and_incorrect.csv');
            const csvText = await response.text();
            const rows = csvText.split('\n');
            let correctEfficiency = 'Not found';
            let incorrectEfficiency = 'Not found';

            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].split(',');
                if (cells[0] === sequence) {
                    correctEfficiency = parseFloat(cells[1]);
                    incorrectEfficiency = parseFloat(cells[2]);
                    break;
                }
            }

            document.getElementById('correct-result').textContent = `Correct Ligation Efficiency for ${sequence}: `;
            document.getElementById('correct-result').appendChild(createEfficiencyElement(correctEfficiency, 'correct'));

            let relativeIncorrectEfficiency = 'Not found';
            if (correctEfficiency !== 'Not found' && incorrectEfficiency !== 'Not found') {
                relativeIncorrectEfficiency = (incorrectEfficiency / correctEfficiency * 100).toFixed(2);
            }

            document.getElementById('incorrect-result').textContent = `Relative Off-Target Efficiency for ${sequence}: `;
            document.getElementById('incorrect-result').appendChild(createEfficiencyElement(relativeIncorrectEfficiency, 'incorrect'));
        }

        function createEfficiencyElement(efficiency, type) {
            const efficiencyValue = isNaN(efficiency) ? efficiency : parseFloat(efficiency);
            const span = document.createElement('span');
            span.textContent = efficiencyValue + (type === 'correct' ? ' (Top ' + (100 - efficiencyValue).toFixed(2) + '%)' : '');

            if (type === 'correct') {
                // ... (existing code for correct efficiency styling and tooltips)
            } else if (type === 'incorrect') {
                // ... (existing code for incorrect efficiency styling and tooltips)
            }

            return span;
        }
    </script>
</head>
<body>
    <h1>4-mer Ligation Efficiency Lookup</h1>
    <form onsubmit="lookupEfficiency()">
        <input type="text" id="sequence-input" maxlength="4" placeholder="Enter 4-mer (e.g., ACCT)" required>
        <input type="submit" value="Lookup">
    </form>
    <p id="correct-result"></p>
    <p id="incorrect-result"></p>
</body>
</html>

